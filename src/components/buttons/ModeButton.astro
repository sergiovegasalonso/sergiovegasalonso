---
import Button from "@components/buttons/Button.astro";
import SunIcon from "@components/icons/SunIcon.astro";
import MoonIcon from "@components/icons/MoonIcon.astro";

const id = "mode-button";
---

<Button id={id} text="Mode">
  <div id="sun-icon"><SunIcon /></div>
  <div id="moon-icon"><MoonIcon /></div>
</Button>

<script define:vars={{ id }}>
  const THEME = {
    LIGHT: "light",
    DARK: "dark",
  };
  const html = document.getElementById("root");
  const modeButton = document.getElementById(id);

  setThemeFromLocalStorageOrPrefersColorScheme();
  setEventListeners();

  function setEventListeners() {
    modeButton?.addEventListener("click", () => {
      localStorage["mode"] === THEME.LIGHT ? setDarkMode() : setLightMode();
    });
  }

  function setThemeFromLocalStorageOrPrefersColorScheme() {
    localStorage["mode"] === THEME.DARK ||
    (!("mode" in localStorage) &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
      ? setDarkMode()
      : setLightMode();
  }

  function setLightMode() {
    html?.classList.remove(THEME.DARK);
    html?.classList.add(THEME.LIGHT);
    localStorage.setItem("mode", THEME.LIGHT);
  }

  function setDarkMode() {
    html?.classList.remove(THEME.LIGHT);
    html?.classList.add(THEME.DARK);
    localStorage.setItem("mode", THEME.DARK);
  }
</script>
